\chapter{Implementace}

Tato kapitola popisuje implementaci dokumentace a komponent.

\section{Struktura logiky}
\label{sec:structure}

Všechna logika komponenty je zapouzdřena v primitivní funkci.
Tato funkce nese název \texttt{create*}, kde \texttt{*} je název komponenty.
Všechny komponenty mají stejnou signaturu funkce, která vrací objekt s následujícími klíči:

\begin{itemize}
    \item \textbf{props} --- objekt s ARIA a HTML atributy a \textit{event listeners}.
    \item \textbf{state} --- stav komponenty, většinou se jedná o vnitřní stav komponenty, který chceme vystavit uživateli komponenty.
    \item \textbf{reference} --- některé komponenty potřebují referenci na přímý HTML element, který se v Solid.js předává pomocí proměnných\footnote{\url{https://solidjs.com/tutorial/bindings_refs}} a direktiv\footnote{\url{https://solidjs.com/tutorial/bindings_directives}}.
\end{itemize}

Některé komponenty (například \fr{SpinButton}) mají více HTML elementů na které je potřeba navázat ARIA atributy a event listeners, proto jejich funkce vrací více \textbf{props} klíčů (například buttonProps, rootProps).

Koncový uživatel tuto primitivní funkci zavolá v definici komponenty a předá jí všechny potřebné argumenty.
Manuálně naváže \textbf{props} na HTML elementy, předá potřebné reference a využije \textbf{state} pro vykreslení stavu komponenty.
Výhodou tohoto přístupu z kapitoly~\ref{technology:dist} je, že vývojář má absolutní kontrolu nad HTML strukturou komponenty a použitým CSS řešením.

\clearpage

\begin{lstlisting}[caption={Příklad implementace komponenty pomocí primitivní funkce}, label={implementation-example}, language=html]
import { createExample, type ExampleArgs } from "lib"
import type { Component } from "solid-js";

export const Example: Component<ExampleArgs> = (args) => {
    const {
        rootProps,
        buttonProps,
        state
    } = createExample(args)(*@\label{docs-page-example-9}@*)

    return (
        <div {...rootProps}>(*@\label{docs-page-example-12}@*)
            <button {...buttonProps}>Toggle</button>(*@\label{docs-page-example-13}@*)
            {state.isVisible ? <p>Content</p> : null}(*@\label{docs-page-example-14}@*)
        </div>
    )
}
\end{lstlisting}

Na ukázce~\ref{implementation-example} je příklad použití primitivní funkce \texttt{createExample} pro vytvoření komponenty \texttt{Example}.
Řádek~\ref{docs-page-example-9} zavolá primitivní funkci a předá jí argumenty, které jsou definovány v \texttt{ExampleArgs}.
Elementům na řádku~\ref{docs-page-example-12} a~\ref{docs-page-example-13} jsou předány atributy a event listeners pomocí spread operátoru.
Na řádku~\ref{docs-page-example-14} je ukázka využití vnitřního stavu komponenty pro vykreslení obsahu.

\subsection{Adresářová struktura}

TODO

\section{Carousel}

TODO

\section{Disclosure}

TODO

\section{SpinButton}

TODO

\section{Toolbar}

TODO

\clearpage

\section{Dokumentace}

TODO

\begin{lstlisting}[caption={Ukázka stránky dokumentace psané v MDX}, label={docs-page-example}, language=html]
---(*@\label{docs-page-example-1}@*)
title: Toolbar
description: a primitive for creating a Toolbar component
sidebar:
    badge:
        text: v0
        variant: success
---(*@\label{docs-page-example-8}@*)

<Links github="https://example.com" />(*@\label{docs-page-example-10}@*)

## Anatomy

<Anatomy viewBox="0 0 64 64" alt="0" caption="Example">
    <ToolbarAnatomy />
</Anatomy>

## API Reference

<PropTable name="ToolbarArguments" />(*@\label{docs-page-example-20}@*)

## Example

<Toolbar client:idle />(*@\label{docs-page-example-24}@*)
\end{lstlisting}

Na ukázce~\ref{docs-page-example} řádek~\ref{docs-page-example-1} až~\ref{docs-page-example-8} definuje tzv. \textit{frontmatter}, který obsahuje metadata o stránce jako je název a popis.
Komponenta \fr{Links} (řádek~\ref{docs-page-example-10}) je Astro komponenta, která zobrazuje odkazy na různé užitečné zdroje jako je zdrojový kód, \gls{apg} dokumentace dané komponenty, pokrytí kódu, nebo vygenerovaná typedoc dokumentace.
Další užitečnou Astro komponentou je \fr{PropTable} (řádek~\ref{docs-page-example-20}), která zobrazuje tabulku argumentů včetně výchozích hodnot a jejich typu.
V neposlední řadě na řádku~\ref{docs-page-example-24} je ukázka použití implementované komponenty v Solid.js, v tomto případě se jedná o Toolbar.
Direktiva \texttt{client:idle} je specifická pro Astro, která nám říká jakým způsobem se má komponenta \gls{hydratace}.

\section{Demo aplikace}

Důležitým aspektem pro demo aplikaci je co nejbližší simulace reálného prostředí, kde se komponenty budou používat.
Pro tento účel jsem zvolil meta-framework \fr{SolidStart}. Meta-framework je své podstatě framework postavený nad vícero frameworky, který zjednodušuje různé aspekty vývoje.
V kontextu meta-frameworků na webu se může jednat například o \gls{ssr}, \textit{routing} a \textit{serverless} funkce~\cite{prismic-metaframework}.

\fr{SolidStart} je oficiálně podporovaný a vyvíjený autorem Ryanem Carniatem, který je také autorem Solid.js.
Výhoda testování komponent v prostředí meta-frameworku spočívá v tom, že komponenta je vystavená různým kontextům jako je \gls{ssr}, \gls{ssg} a \gls{csr}.
